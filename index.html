<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Souvenir Bank WM</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        navy: { 900: '#0f172a', 800: '#1e293b' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        
        .header-gradient { 
            background: linear-gradient(135deg, #2563eb 0%, #0f172a 100%); 
        }
        
        .input-concave {
            background-color: #f1f5f9;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        .input-concave:focus {
            background-color: #fff;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
            outline: none; border-color: #3b82f6;
        }

        .card-glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .nav-item.active {
            color: #2563eb;
            font-weight: 700;
        }
        .nav-item.active i {
            transform: translateY(-2px);
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .class-card {
            transition: transform 0.2s;
        }
        .class-card:active { transform: scale(0.98); }
        .class-card.disabled { opacity: 0.6; filter: grayscale(100%); }
    </style>
</head>
<body class="text-slate-800 antialiased h-screen flex flex-col relative overflow-hidden font-sans bg-slate-50">

    <!-- ================= HEADER ================= -->
    <header class="header-gradient text-white pt-8 pb-20 px-6 shadow-xl rounded-b-[3rem] relative z-10 flex-none transition-all duration-300" id="mainHeader">
        <div class="max-w-md mx-auto flex items-center justify-between">
            <div>
                <p class="text-blue-200 text-[10px] font-bold tracking-widest uppercase mb-1">Internal Dashboard</p>
                <h1 class="text-2xl font-bold tracking-tight text-white leading-none">Souvenir Bank WM</h1>
                <div class="flex items-center gap-2 mt-2 bg-white/10 w-fit px-3 py-1 rounded-full backdrop-blur-sm">
                    <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                    <p class="text-white text-[10px] font-medium" id="lastUpdated">Update: ...</p>
                </div>
            </div>
            <div class="w-12 h-12 bg-white/10 rounded-2xl flex items-center justify-center backdrop-blur-md border border-white/10 shadow-inner">
                <i class="fas fa-cube text-xl text-white"></i>
            </div>
        </div>
    </header>

    <!-- ================= CONTENT AREA ================= -->
    <main class="flex-1 relative -mt-12 z-20 w-full max-w-md mx-auto overflow-hidden flex flex-col">
        
        <!-- VIEW: KATALOG STOCK -->
        <div id="viewCatalog" class="flex-1 flex flex-col h-full overflow-hidden animate-fade-in">
            <!-- Search & Filter -->
            <div class="px-5 pb-2 flex-none">
                <div class="card-glass p-4 space-y-4">
                    <!-- Search & Sort Row -->
                    <div class="flex gap-2">
                        <div class="relative flex-1">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm"></i>
                            <input type="text" id="searchInput" placeholder="Cari barang..." class="input-concave w-full pl-10 pr-3 py-3 rounded-xl text-sm font-medium bg-slate-50">
                        </div>
                        
                        <!-- Sort Controls -->
                        <div class="flex gap-1 w-5/12">
                            <div class="relative flex-1">
                                <select id="sortSelect" onchange="renderItems()" class="appearance-none input-concave w-full pl-3 pr-6 py-3 rounded-xl text-xs font-bold text-slate-600 bg-slate-50 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="name">Nama</option>
                                    <option value="class">Kelas</option>
                                    <option value="stock">Stock</option>
                                </select>
                            </div>
                            <button id="sortDirBtn" onclick="toggleSortDir()" class="w-10 bg-white border border-slate-200 rounded-xl flex items-center justify-center text-slate-500 hover:bg-slate-50 active:scale-95 transition-all">
                                <i class="fas fa-sort-amount-down text-sm" id="sortIcon"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Filter Chips -->
                    <div class="flex justify-between items-center gap-2 overflow-x-auto pb-1 no-scrollbar" id="categoryFilterContainer"></div>
                </div>
            </div>

            <!-- List Items -->
            <div class="flex-1 overflow-y-auto px-5 pt-2 pb-24 no-scrollbar" id="catalogScroll">
                <div id="loadingState" class="text-center py-20">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"></div>
                    <p class="text-xs text-slate-400">Mengambil data gudang...</p>
                </div>
                <div id="emptyState" class="hidden text-center py-20 opacity-50">
                    <i class="fas fa-box-open text-4xl mb-2 text-slate-300"></i>
                    <p class="text-sm text-slate-400">Barang tidak ditemukan</p>
                </div>
                <div id="itemsContainer" class="grid gap-4 pb-4"></div>
                
                <!-- Footer Signature -->
                <div class="text-center pt-8 pb-4 opacity-40">
                    <p class="text-[10px] font-black tracking-[0.3em] uppercase text-slate-400">BizDev X GA</p>
                </div>
            </div>
        </div>

        <!-- VIEW: PANDUAN / GUIDELINE -->
        <div id="viewGuideline" class="hidden flex-1 flex-col h-full overflow-hidden animate-fade-in bg-white/50 backdrop-blur-sm">
            <div class="flex-1 overflow-y-auto px-5 pt-6 pb-24 no-scrollbar">
                
                <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 mb-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 pointer-events-none">
                        <i class="fas fa-calculator text-6xl text-blue-900"></i>
                    </div>
                    <h2 class="text-lg font-bold text-slate-800 mb-1">Cek Hak Souvenir</h2>
                    <p class="text-xs text-slate-500 mb-4">Pilih jenis transaksi untuk melihat kelas souvenir.</p>
                    
                    <!-- Tabs Kalkulator -->
                    <div class="flex p-1 bg-slate-100 rounded-xl mb-4">
                        <button onclick="switchCalc('deposito')" class="calc-tab flex-1 py-2.5 text-xs font-bold rounded-lg text-slate-500 transition-all active-calc" data-target="deposito">Tanam Deposito</button>
                        <button onclick="switchCalc('lunas')" class="calc-tab flex-1 py-2.5 text-xs font-bold rounded-lg text-slate-500 transition-all" data-target="lunas">Pelunasan Kredit</button>
                    </div>

                    <!-- Form Deposito -->
                    <div id="formDeposito" class="calc-form space-y-4 animate-fade-in">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Nominal Penempatan</label>
                            <div class="relative">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400">Rp</span>
                                <input type="text" id="depositoNominal" onkeyup="formatRupiah(this)" class="input-concave w-full pl-10 pr-4 py-3 rounded-xl text-sm font-bold text-slate-700" placeholder="0">
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Jangka Waktu</label>
                            <div class="relative">
                                <select id="depositoTenor" class="input-concave w-full px-4 py-3 rounded-xl text-sm font-bold text-slate-700 bg-white appearance-none">
                                    <option value="1">1 Bulan</option>
                                    <option value="3">3 Bulan</option>
                                    <option value="6">6 Bulan</option>
                                    <option value="12">12 Bulan</option>
                                    <option value="24">24 Bulan</option>
                                    <option value="36">36 Bulan</option>
                                    <option value="60">60 Bulan</option>
                                </select>
                                <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 text-xs"></i>
                            </div>
                        </div>
                        <button onclick="checkDeposito()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3.5 rounded-xl font-bold text-sm shadow-lg shadow-blue-200 active:scale-95 transition-transform flex items-center justify-center gap-2">
                            <i class="fas fa-search"></i> Cek Souvenir
                        </button>
                    </div>

                    <!-- Form Pelunasan Kredit (Baru) -->
                    <div id="formLunas" class="calc-form space-y-4 hidden animate-fade-in">
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Plafon Kredit</label>
                            <div class="relative">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400">Rp</span>
                                <input type="text" id="kreditPlafon" onkeyup="formatRupiah(this)" class="input-concave w-full pl-10 pr-4 py-3 rounded-xl text-sm font-bold text-slate-700" placeholder="0">
                            </div>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Jangka Waktu (Bulan)</label>
                            <input type="number" id="kreditTenor" class="input-concave w-full px-4 py-3 rounded-xl text-sm font-bold text-slate-700" placeholder="Contoh: 12">
                        </div>
                        <button onclick="checkKredit()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-3.5 rounded-xl font-bold text-sm shadow-lg shadow-purple-200 active:scale-95 transition-transform flex items-center justify-center gap-2">
                            <i class="fas fa-search"></i> Cek Souvenir
                        </button>
                    </div>
                </div>

                <!-- RESULT AREA -->
                <div id="resultArea" class="hidden">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="h-px bg-slate-200 flex-1"></div>
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Hasil Pengecekan</span>
                        <div class="h-px bg-slate-200 flex-1"></div>
                    </div>
                    
                    <div id="resultCardsContainer" class="grid grid-cols-1 gap-3 animate-fade-in">
                        <!-- Cards injected here -->
                    </div>
                </div>

            </div>
        </div>

    </main>

    <!-- ================= BOTTOM NAVIGATION ================= -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 pb-safe pt-2 px-6 z-50 shadow-[0_-10px_40px_rgba(0,0,0,0.05)]">
        <div class="max-w-md mx-auto flex justify-around items-center h-16">
            <button onclick="switchTab('catalog')" class="nav-item active flex flex-col items-center gap-1 w-16 transition-colors duration-300" id="navCatalog">
                <i class="fas fa-th-large text-xl transition-transform duration-300"></i>
                <span class="text-[10px] font-medium">Katalog</span>
            </button>
            
            <div class="w-px h-8 bg-slate-100"></div>
            
            <button onclick="switchTab('guideline')" class="nav-item text-slate-300 flex flex-col items-center gap-1 w-16 transition-colors duration-300" id="navGuideline">
                <i class="fas fa-book-open text-xl transition-transform duration-300"></i>
                <span class="text-[10px] font-medium">Panduan</span>
            </button>
        </div>
    </nav>

    <!-- IMAGE MODAL -->
    <div id="imageModal" class="fixed inset-0 z-[60] bg-black/90 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="this.classList.add('hidden')">
        <img id="modalImg" class="max-w-full max-h-[80vh] rounded-xl shadow-2xl transition-transform duration-300 scale-95" src="">
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxSyJO1LCc1SvbwsNCcdVkVCXHPkDyxQHLxEp0UrwjDW4-K-74o7yJ72fkmsaJMEJvaFQ/exec"; 

        let inventoryData = [];
        let currentFilter = 'all';
        let isDemoMode = false;
        let sortAsc = true;

        const CLASS_COLORS = {
            'A': { bg: 'bg-rose-50', text: 'text-rose-600', badge: 'bg-rose-500 text-white', border: 'border-rose-100', icon: 'fa-crown' },
            'B': { bg: 'bg-orange-50', text: 'text-orange-600', badge: 'bg-orange-500 text-white', border: 'border-orange-100', icon: 'fa-star' },
            'C': { bg: 'bg-amber-50', text: 'text-amber-600', badge: 'bg-amber-500 text-white', border: 'border-amber-100', icon: 'fa-medal' },
            'D': { bg: 'bg-emerald-50', text: 'text-emerald-600', badge: 'bg-emerald-500 text-white', border: 'border-emerald-100', icon: 'fa-award' },
            'E': { bg: 'bg-cyan-50', text: 'text-cyan-600', badge: 'bg-cyan-500 text-white', border: 'border-cyan-100', icon: 'fa-gift' },
            'F': { bg: 'bg-violet-50', text: 'text-violet-600', badge: 'bg-violet-500 text-white', border: 'border-violet-100', icon: 'fa-smile' }
        };

        const DUMMY_DATA = [
            { id: 'A-01', nama: 'Tumbler Stainless Premium', kategori: 'A', stok: 50, satuan: 'Pcs', foto: '' },
            { id: 'C-01', nama: 'Notes Kulit A5', kategori: 'C', stok: 100, satuan: 'Pcs', foto: '' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            if (!API_URL || API_URL.includes("script.google.com") === false) isDemoMode = true;
            renderFilterButtons();
            fetchData();
            updateLastSeen();
        });

        function switchTab(tab) {
            const navCat = document.getElementById('navCatalog');
            const navGuide = document.getElementById('navGuideline');
            const viewCat = document.getElementById('viewCatalog');
            const viewGuide = document.getElementById('viewGuideline');
            const header = document.getElementById('mainHeader');

            if (tab === 'catalog') {
                navCat.classList.add('active', 'text-blue-600');
                navCat.classList.remove('text-slate-300');
                navGuide.classList.remove('active', 'text-blue-600');
                navGuide.classList.add('text-slate-300');
                viewCat.classList.remove('hidden');
                viewGuide.classList.add('hidden');
                header.classList.remove('-translate-y-full'); 
            } else {
                navGuide.classList.add('active', 'text-blue-600');
                navGuide.classList.remove('text-slate-300');
                navCat.classList.remove('active', 'text-blue-600');
                navCat.classList.add('text-slate-300');
                viewGuide.classList.remove('hidden');
                viewCat.classList.add('hidden');
                header.classList.add('-translate-y-full'); 
            }
        }

        async function fetchData() {
            try {
                let data = [];
                if (isDemoMode) {
                    await new Promise(r => setTimeout(r, 500));
                    data = DUMMY_DATA;
                } else {
                    const res = await fetch(API_URL);
                    const json = await res.json();
                    if (json.status === 'success') data = json.data;
                }
                inventoryData = data;
                renderItems();
            } catch (err) {
                console.error(err);
                if (!isDemoMode) { isDemoMode = true; fetchData(); }
            } finally {
                document.getElementById('loadingState').classList.add('hidden');
                if (inventoryData.length === 0) document.getElementById('emptyState').classList.remove('hidden');
            }
        }

        function updateLastSeen() {
            const now = new Date();
            const options = { weekday: 'short', day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' };
            document.getElementById('lastUpdated').innerText = `Update: ${now.toLocaleDateString('id-ID', options)}`;
        }

        function toggleSortDir() {
            sortAsc = !sortAsc;
            const icon = document.getElementById('sortIcon');
            icon.className = sortAsc ? 'fas fa-sort-amount-down text-sm' : 'fas fa-sort-amount-up text-sm';
            renderItems();
        }

        function renderItems() {
            const container = document.getElementById('itemsContainer');
            container.innerHTML = '';
            
            const term = document.getElementById('searchInput').value.toLowerCase();
            const sortVal = document.getElementById('sortSelect').value;

            let filtered = inventoryData.filter(item => {
                const matchTerm = item.nama.toLowerCase().includes(term);
                const matchCat = currentFilter === 'all' || item.kategori === currentFilter;
                return matchTerm && matchCat;
            });

            filtered.sort((a, b) => {
                let valA, valB;
                if (sortVal === 'name') { valA = a.nama; valB = b.nama; }
                else if (sortVal === 'class') { valA = a.kategori; valB = b.kategori; }
                else if (sortVal === 'stock') { valA = a.stok; valB = b.stok; }

                if (valA < valB) return sortAsc ? -1 : 1;
                if (valA > valB) return sortAsc ? 1 : -1;
                return 0;
            });

            if(filtered.length === 0 && inventoryData.length > 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            } else {
                document.getElementById('emptyState').classList.add('hidden');
            }

            filtered.forEach(item => {
                const colors = CLASS_COLORS[item.kategori] || { bg: 'bg-slate-50', text: 'text-slate-600', badge: 'bg-slate-500 text-white', border: 'border-slate-100' };
                let imgEl = item.foto && item.foto.length > 20 ? `<img src="${item.foto}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">` : `<div class="w-full h-full bg-slate-100 flex items-center justify-center text-slate-300"><i class="fas fa-image text-3xl"></i></div>`;

                const card = document.createElement('div');
                card.className = `bg-white rounded-3xl p-3 shadow-sm border ${colors.border} flex h-32 relative group overflow-hidden`;
                card.innerHTML = `
                    <div class="w-[40%] h-full rounded-2xl overflow-hidden relative" onclick="viewImage('${item.foto}')">
                        ${imgEl}
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"></div>
                    </div>
                    <div class="flex-1 pl-4 flex flex-col justify-between py-1">
                        <div>
                            <div class="flex justify-between items-start">
                                <span class="${colors.bg} ${colors.text} text-[10px] font-extrabold px-2 py-1 rounded-lg uppercase tracking-wider mb-1 inline-block border ${colors.border}">Kelas ${item.kategori}</span>
                            </div>
                            <h3 class="font-bold text-slate-800 text-sm leading-snug line-clamp-2">${item.nama}</h3>
                        </div>
                        <div class="flex items-end justify-between">
                            <div class="flex flex-col">
                                <span class="text-[9px] text-slate-400 font-bold uppercase tracking-wider">Sisa Stock</span>
                                <div class="flex items-baseline gap-1">
                                    <span class="text-2xl font-black text-slate-800 leading-none">${item.stok}</span>
                                    <span class="text-[10px] font-medium text-slate-500">${item.satuan}</span>
                                </div>
                            </div>
                            <span class="text-[9px] font-mono text-slate-300 bg-slate-50 px-1 rounded">${item.id}</span>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderFilterButtons() {
            const container = document.getElementById('categoryFilterContainer');
            container.innerHTML = '';
            
            const btnAll = document.createElement('button');
            btnAll.textContent = 'Semua';
            btnAll.onclick = () => filterCategory('all');
            btnAll.className = currentFilter === 'all' 
                ? 'flex-none bg-slate-800 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-lg shadow-slate-200 transition-all'
                : 'flex-none bg-white text-slate-500 border border-slate-200 px-4 py-2 rounded-xl text-xs font-bold';
            container.appendChild(btnAll);

            ['A', 'B', 'C', 'D', 'E', 'F'].forEach(c => {
                const colors = CLASS_COLORS[c];
                const btn = document.createElement('button');
                btn.innerText = c;
                btn.onclick = () => filterCategory(c);
                btn.className = currentFilter === c 
                    ? `flex-none ${colors.badge} w-10 py-2 rounded-xl text-xs font-bold shadow-lg transition-transform scale-105` 
                    : `flex-none bg-white text-slate-500 border border-slate-200 w-10 py-2 rounded-xl text-xs font-bold`;
                container.appendChild(btn);
            });
        }

        function filterCategory(cat) {
            currentFilter = cat;
            renderFilterButtons();
            renderItems();
        }

        document.getElementById('searchInput').addEventListener('input', renderItems);

        function viewImage(src) {
            if(src && src.length > 20) {
                document.getElementById('modalImg').src = src;
                document.getElementById('imageModal').classList.remove('hidden');
            }
        }

        function formatRupiah(el) {
            let val = el.value.replace(/\D/g, '');
            el.value = val ? new Intl.NumberFormat('id-ID').format(val) : '';
        }

        function getNumber(id) {
            return parseInt(document.getElementById(id).value.replace(/\./g, '')) || 0;
        }

        function switchCalc(type) {
            document.querySelectorAll('.calc-tab').forEach(b => {
                b.classList.remove('bg-slate-800', 'text-white', 'shadow-md');
                b.classList.add('text-slate-500');
                if(b.dataset.target === type) {
                    b.classList.add('bg-slate-800', 'text-white', 'shadow-md');
                    b.classList.remove('text-slate-500');
                }
            });

            document.querySelectorAll('.calc-form').forEach(f => f.classList.add('hidden'));
            if(type === 'deposito') document.getElementById('formDeposito').classList.remove('hidden');
            if(type === 'lunas') document.getElementById('formLunas').classList.remove('hidden');
            
            document.getElementById('resultArea').classList.add('hidden');
        }

        switchCalc('deposito');

        // === HASIL RESULT CARD ===
        function showResultCards(grades) {
            const area = document.getElementById('resultArea');
            const container = document.getElementById('resultCardsContainer');
            
            area.classList.remove('hidden');
            container.innerHTML = '';

            if (grades.length === 0 || grades[0] === 'X') {
                container.innerHTML = `
                    <div class="bg-slate-100 p-4 rounded-xl text-center border border-slate-200">
                        <i class="fas fa-times-circle text-slate-300 text-2xl mb-2"></i>
                        <p class="text-sm font-bold text-slate-500">Belum memenuhi syarat</p>
                    </div>
                `;
                setTimeout(() => area.scrollIntoView({ behavior: 'smooth' }), 100);
                return;
            }

            // Loop untuk setiap hasil (bisa 1 atau 2 kartu)
            grades.forEach((grade, index) => {
                // Separator "ATAU" jika ada 2 opsi
                if (index > 0) {
                    const separator = document.createElement('div');
                    separator.className = 'flex items-center gap-2 justify-center py-1';
                    separator.innerHTML = `
                        <div class="h-px bg-slate-200 w-8"></div>
                        <span class="text-[10px] font-bold text-slate-400">ATAU</span>
                        <div class="h-px bg-slate-200 w-8"></div>
                    `;
                    container.appendChild(separator);
                }

                // Cek Stok untuk kelas ini
                const itemsInClass = inventoryData.filter(i => i.kategori === grade && i.stok > 0);
                const hasStock = itemsInClass.length > 0;
                
                const colors = CLASS_COLORS[grade] || { bg: 'bg-slate-50', text: 'text-slate-600', badge: 'bg-slate-500 text-white', border: 'border-slate-100', icon: 'fa-gift' };
                
                const card = document.createElement('div');
                
                if (hasStock) {
                    card.className = `class-card flex items-center p-4 gap-4 ${colors.bg} border-l-4 ${colors.border.replace('border', 'border-l')} cursor-pointer`;
                    card.style.borderLeftColor = colors.text.replace('text-', '').replace('600', '500'); // Hack simple color match
                    card.innerHTML = `
                        <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center shadow-sm flex-none">
                            <i class="fas ${colors.icon} text-xl ${colors.text}"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Hak Nasabah</p>
                            <h3 class="text-xl font-bold ${colors.text}">Souvenir Kelas ${grade}</h3>
                            <p class="text-[10px] text-slate-500 mt-0.5">Tersedia ${itemsInClass.length} jenis barang</p>
                        </div>
                        <i class="fas fa-chevron-right ml-auto text-slate-300"></i>
                    `;
                    card.onclick = () => { switchTab('catalog'); filterCategory(grade); };
                } else {
                    // Tampilan Stok Habis
                    card.className = `class-card flex items-center p-4 gap-4 bg-slate-100 border border-slate-200 opacity-80`;
                    card.innerHTML = `
                        <div class="w-12 h-12 rounded-full bg-slate-200 flex items-center justify-center shadow-inner flex-none">
                            <i class="fas ${colors.icon} text-xl text-slate-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-[10px] uppercase font-bold text-slate-400 tracking-wider">Hak Nasabah</p>
                            <h3 class="text-xl font-bold text-slate-500">Souvenir Kelas ${grade}</h3>
                            <div class="inline-flex items-center gap-1 mt-1 bg-red-100 px-2 py-0.5 rounded text-red-600 text-[10px] font-bold">
                                <i class="fas fa-exclamation-circle"></i> Stok Kosong
                            </div>
                        </div>
                    `;
                }
                
                container.appendChild(card);
            });
            
            setTimeout(() => area.scrollIntoView({ behavior: 'smooth' }), 100);
        }

        // ============================================
        // LOGIKA BARU SESUAI INSTRUKSI DETAIL
        // ============================================

        // 1. DEPOSITO (Tanam Depo)
        function checkDeposito() {
            const n = getNumber('depositoNominal');
            const t = parseInt(document.getElementById('depositoTenor').value);
            let grades = [];

            if (n >= 8000000 && n < 25000000) {
                if (t >= 1 && t <= 3) grades = ['F'];
                else if (t >= 6 && t <= 12) grades = ['E', 'F'];
                else if (t == 24) grades = ['D', 'E'];
                else if (t >= 36) grades = ['B', 'C'];
            } 
            else if (n >= 25000000 && n < 50000000) {
                if (t == 1) grades = ['F'];
                else if (t == 3) grades = ['E', 'F'];
                else if (t >= 6 && t <= 12) grades = ['D', 'E'];
                else if (t == 24) grades = ['C', 'D'];
                else if (t == 36) grades = ['B', 'C'];
                else if (t == 60) grades = ['A', 'B'];
            }
            else if (n >= 50000000 && n < 75000000) {
                if (t == 1) grades = ['E', 'F'];
                else if (t == 3) grades = ['D', 'E'];
                else if (t >= 6 && t <= 12) grades = ['C', 'D'];
                else if (t == 24) grades = ['B', 'C'];
                else if (t >= 36) grades = ['A', 'B'];
            }
            else if (n >= 75000000 && n < 100000000) {
                if (t == 1) grades = ['D', 'E'];
                else if (t == 3) grades = ['C', 'D'];
                else if (t >= 6 && t <= 12) grades = ['B', 'C'];
                else if (t >= 24) grades = ['A', 'B'];
            }
            else if (n >= 100000000 && n < 200000000) {
                if (t == 1) grades = ['C', 'D'];
                else if (t == 3) grades = ['B', 'C'];
                else if (t >= 6) grades = ['A', 'B'];
            }
            else if (n >= 200000000 && n < 300000000) {
                if (t == 1) grades = ['B', 'C'];
                else if (t >= 3) grades = ['A', 'B'];
            }
            else if (n >= 300000000) {
                grades = ['A', 'B'];
            }
            else {
                grades = ['X']; // Di bawah 8 Juta
            }

            showResultCards(grades);
        }

        // 2. KREDIT (Pelunasan Lancar)
        function checkKredit() {
            const p = getNumber('kreditPlafon');
            const t = parseInt(document.getElementById('kreditTenor').value);
            let grades = [];

            if (p >= 15000000 && p < 25000000) {
                if (t <= 12) grades = ['F'];
                else if (t >= 13 && t <= 24) grades = ['E', 'F'];
                else if (t > 24) grades = ['D', 'E'];
            }
            else if (p >= 25000000 && p < 50000000) {
                if (t <= 12) grades = ['E', 'F'];
                else grades = ['D', 'E'];
            }
            else if (p >= 50000000 && p < 75000000) {
                if (t <= 12) grades = ['D', 'E'];
                else grades = ['C', 'D'];
            }
            else if (p >= 75000000 && p < 100000000) {
                if (t <= 12) grades = ['D', 'E'];
                else if (t >= 13 && t <= 36) grades = ['C', 'D'];
                else grades = ['B', 'C'];
            }
            else if (p >= 100000000 && p < 200000000) {
                if (t <= 12) grades = ['C', 'D'];
                else grades = ['B', 'C'];
            }
            else if (p >= 200000000 && p < 300000000) {
                if (t <= 36) grades = ['B', 'C'];
                else grades = ['A', 'B'];
            }
            else if (p >= 300000000 && p < 400000000) {
                if (t <= 12) grades = ['B', 'C'];
                else grades = ['A', 'B'];
            }
            else if (p >= 400000000) {
                grades = ['A', 'B'];
            }
            else {
                grades = ['X']; // Di bawah 15 Juta
            }

            showResultCards(grades);
        }

    </script>
</body>
</html>
